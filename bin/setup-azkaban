#!/bin/bash

if [ -z "$AZKABAN_HOME" ]; then
  echo "AZKABAN_HOME is not set"
  exit 1
fi

AZKABAN_SOLO_SERVER_DIR=$AZKABAN_HOME/dist/packages/azkaban-solo-server

if [ ! -d $AZKABAN_SOLO_SERVER_DIR ]; then
  echo "Azkaban solo server has not been built"
  exit 1
fi

echo "copy    global azkaban.properties"
cp $HOME/etc/azkaban/azkaban.properties $AZKABAN_SOLO_SERVER_DIR/conf
pushd $AZKABAN_SOLO_SERVER_DIR/plugins > /dev/null

$HOME/bin/grab-jobtype-plugin $1
echo "copy    jobtypes plugin.properties"
cp $HOME/etc/azkaban/jobtypes/pig/plugin.properties ./jobtypes/pig
cp $HOME/etc/azkaban/jobtypes/hadoopJava/plugin.properties ./jobtypes/hadoopJava

mkdir -p viewer
pushd viewer > /dev/null

$HOME/bin/grab-hdfs-plugin $1
echo "copy    hdfs plugin.properties"
cp $HOME/etc/azkaban/hdfs/plugin.properties ./hdfs/conf

$HOME/bin/grab-pigvisualizer-plugin $1
echo "copy    pigvisualizer plugin.properties"
cp $HOME/etc/azkaban/pigvisualizer/plugin.properties ./pigvisualizer/conf

$HOME/bin/grab-javaviewer-plugin $1
echo "copy    javaviewer plugin.properties"
cp $HOME/etc/azkaban/javaviewer/plugin.properties ./javaviewer/conf
