#!/bin/sh

set -e

readonly DEST_DIR=$HOME
readonly BACK_DIR=$DEST_DIR/.dotfiles.bak
readonly OWD=`pwd`

installdot() {
  local install=$OWD/$1
  echo "==> install .$1"

  if [ ! -e $BACK_DIR ]; then
    echo "$BACK_DIR does not exist!"
    return
  fi

  if [ -e $BACK_DIR/$1 ]; then
    if [ ! -L $DEST_DIR/.$1 ]; then
      echo "Warning: .$1 exists in $BACK_DIR but is not a symlink in $DEST_DIR."
    fi
    return
  fi

  if [ -e $DEST_DIR/.$1 ]; then
    mv $DEST_DIR/.$1 $BACK_DIR
  fi

  ln -s $install $DEST_DIR/.$1
}

if [ ! -d $BACK_DIR ]; then
  mkdir -p $BACK_DIR
fi

echo "==> install vundle"
mkdir -p vim/bundle
git clone https://github.com/gmarik/Vundle.vim vim/bundle/Vundle.vim

echo "==> install tpm"
mkdir -p tmux/plugins
git clone https://github.com/tmux-plugins/tpm tmux/plugins/tpm

echo "==> install spacemacs"
git clone --recursive https://github.com/syl20bnr/spacemacs emacs.d

echo "==> install aosp repo tool"
curl https://storage.googleapis.com/git-repo-downloads/repo > bin/repo
chmod a+x bin/repo

echo "==> install chromium depo_tools"
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git \
    opt/depot_tools

installdot dots
installdot Xresources
installdot bashrc
installdot gdbinit
installdot gitconfig
installdot gitignore_global
installdot inputrc
installdot rcrc
installdot tmux.conf
installdot tmux
installdot emacs.d
installdot vim
installdot vimrc
installdot vimrc.bundles
installdot vimrc.more
installdot zshrc
installdot bin
installdot lib
installdot yabairc
installdot skhdrc
